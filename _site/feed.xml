<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://haloowhite.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://haloowhite.com/" rel="alternate" type="text/html" /><updated>2025-08-19T12:07:06+08:00</updated><id>https://haloowhite.com/feed.xml</id><title type="html">Whiteâ€™s Blog</title><subtitle>Web Scraping Specialist &amp; Creative Builder</subtitle><author><name>White</name></author><entry><title type="html">æœ‰æ‰‹å°±è¡Œç³»åˆ—â€”â€”æŠ–éŸ³æœ€æ–°bdms_1.0.1.19_fixå‚æ•°æ„é€ a_bogus</title><link href="https://haloowhite.com/2025/08/18/dy-vmp-tutorial/" rel="alternate" type="text/html" title="æœ‰æ‰‹å°±è¡Œç³»åˆ—â€”â€”æŠ–éŸ³æœ€æ–°bdms_1.0.1.19_fixå‚æ•°æ„é€ a_bogus" /><published>2025-08-18T00:00:00+08:00</published><updated>2025-08-18T00:00:00+08:00</updated><id>https://haloowhite.com/2025/08/18/dy-vmp-tutorial</id><content type="html" xml:base="https://haloowhite.com/2025/08/18/dy-vmp-tutorial/"><![CDATA[<h2 id="0èƒŒæ™¯ä»‹ç»">0ã€èƒŒæ™¯ä»‹ç»</h2>

<p>æœ¬æ–‡å°†ç®€å•ç›´æ¥åœ°å¸¦ä½ ä¸€èµ·é€šè¿‡è¡¥ç¯å¢ƒçš„æ–¹å¼ï¼Œå®ç°æŸéŸ³æœ€æ–°çš„a_boguså‚æ•°æ„é€ ï¼Œå¹¶å®ç°éªŒè¯è¯·æ±‚è¿”å›å¯¹åº”æ•°æ®ã€‚</p>

<p>ç›®æ ‡å‚æ•°ä½¿ç”¨JSVMP æŠ€æœ¯æ¥å®ç°å…³é”®çš„åŠ å¯†é€»è¾‘æ··æ·†ã€‚å…³äºJSVMPï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”¨jsåœ¨å‰ç«¯å®ç°äº†ä¸€ä¸ªæ ˆå¼è™šæ‹Ÿæœºï¼Œé€šè¿‡jså®ç°ç›¸å…³çš„åŸå­æ“ä½œï¼ˆç±»ä¼¼æ±‡ç¼–é‡Œçš„æ±‡ç¼–æœºå™¨è¯­å¥ï¼‰ã€‚ç›¸å…³çš„æ›´è¯¦ç»†çš„èµ„æ–™å¯å‚è€ƒè¿™ç¯‡è®ºæ–‡ <a href="https://pub-df7ca5ef070b4d47a2a7c8b98941cb71.r2.dev/Research%20and%20Implementation%20of%20JavaScript%20Code%20Virtualization%20Protection%20Method%20Based%20on%20WebAssembly.pdf">ã€ŠåŸºäº WebAssembly çš„ JavaScript ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤æ–¹æ³•ç ”ç©¶ä¸å®ç°ã€‹</a> ã€‚</p>

<p><img src="https://pub-df7ca5ef070b4d47a2a7c8b98941cb71.r2.dev/Research%20and%20Implementation%20of%20JavaScript%20Code%20Virtualization%20Protection%20Method%20Based%20on%20WebAssembly%20.png" alt="ã€ŠåŸºäº WebAssembly çš„ JavaScript ä»£ç è™šæ‹ŸåŒ–ä¿æŠ¤æ–¹æ³•ç ”ç©¶ä¸å®ç°ã€‹è®ºæ–‡å°é¢" /></p>

<p>è¿™ç±»JSVMPçš„ç‰¹å¾ä¸ºï¼Œåœ¨æºç ä¸­ä¼šæœ‰ä¸€ä¸ªåˆè‡­åˆé•¿çš„å­—ç¬¦ä¸²å’Œä¸€ä¸ªåˆè‡­åˆé•¿çš„å‡½æ•°ï¼Œé‡Œé¢æ˜¯åˆè‡­åˆé•¿çš„å¾ªç¯switchç»“æ„ï¼Œå…¶æœ¬è´¨æ˜¯ç¯å¢ƒåˆå§‹åŒ–çš„å­—èŠ‚ç å’Œå¯¹åº”çš„è§£é‡Šå™¨ã€‚</p>

<p>ä¸ä¹‹ç±»ä¼¼é‡‡ç”¨JSVMPæ‰‹æ®µçš„ï¼Œè¿˜æœ‰çŸ¥ä¹çš„<code class="language-plaintext highlighter-rouge">x-zse-96</code> å‚æ•°ã€è…¾è®¯æ»‘å—ã€å¿«æ‰‹sig3ç­‰</p>

<h2 id="1å¤§è‡´æµç¨‹">1ã€å¤§è‡´æµç¨‹</h2>

<p>ä¸€èˆ¬çš„JSVMPä¹Ÿå¥½ï¼Œé«˜å¼ºåº¦æ··æ·†ä¹Ÿå¥½ï¼Œåªè¦è¡¥ç¯å¢ƒè¡¥å¥½äº†ï¼Œéƒ½å¯ä»¥ç›´æ¥æ— è§†ç›¸å…³çš„å†…éƒ¨çš„æ‰§è¡Œæˆ–å®ç°é€»è¾‘ç»†èŠ‚ã€‚åªéœ€è¦æŠŠjsè¿è¡Œä¸­ç¼ºå¤±çš„ç¯å¢ƒæˆ–æºç ä¸­è¿›è¡Œæ£€æµ‹çš„æµè§ˆå™¨ç›¸å…³ç¯å¢ƒç»™è¡¥å…¨å³å¯ï¼Œç„¶åå†æ·»åŠ ä¸€ä¸ªå¯¹åº”çš„åŠ å¯†å‡½æ•°æ„é€ å…¥å£ï¼Œå®ç°èƒ½å¤Ÿæ„é€ å¯¹åº”å‚æ•°ã€‚</p>

<p>æœ¬æ–‡é¢å¯¹çš„æŠ–éŸ³JSVMPå¯èƒ½éš¾åº¦ä¼šæ›´é«˜ä¸€äº›ï¼Œç­‰ä½ çœŸæ­£å®é™…ä¸Šæ‰‹çš„æ—¶å€™ï¼Œå‘ç°å‡ ä¹æ‰€æœ‰çš„é€»è¾‘éƒ½åœ¨èµ° <code class="language-plaintext highlighter-rouge">return X(e, this, arguments, r)</code> ï¼Œä»¥åŠè§£é‡Šå™¨å‡½æ•° <code class="language-plaintext highlighter-rouge">function d()</code> ä¸­ä¸æ–­å¾ªç¯ã€‚ä¸€èˆ¬æœ‰å‡ ç§è§£å†³æ–¹æ³•ï¼Œä¸€æ˜¯åœ¨ <code class="language-plaintext highlighter-rouge">då‡½æ•°</code> ä¸­å°†å…³é”®çš„å‡½æ•°è°ƒç”¨ã€è¿ç®—é€»è¾‘ï¼Œä»¥åŠå †æ ˆå˜åŒ–ç­‰æ’æ¡©æ‰“æ—¥å¿—ï¼Œç„¶åæ ¹æ®æ‰“å°çš„æ—¥å¿—è¿›è¡Œåˆ†æç›¸å…³çš„é€»è¾‘å’Œå‚æ•°æ„é€ ï¼›è¿˜æœ‰ä¸€ä¸ªæ˜¯åç¼–è¯‘ï¼Œå°†å…³é”®çš„å‡½æ•°æ‰§è¡Œç­‰åˆ†æå‡ºæ¥å†å¤ç°ï¼›å†æœ‰å°±æ˜¯ï¼Œæˆ‘ä»¬æœ¬æ–‡ç”¨çš„è¡¥ç¯å¢ƒå¤§æ³•ï¼Œå®ç°è¡¥é½ä»£ç ä¸­ç”¨åˆ°çš„æµè§ˆå™¨ç¯å¢ƒï¼Œå¹¶æ„é€ ç›¸å…³çš„åŠ å¯†å…¥å£å®ç°å‚æ•°ç”Ÿæˆã€‚</p>

<h2 id="2è¡¥ç¯å¢ƒç»†èŠ‚">2ã€è¡¥ç¯å¢ƒç»†èŠ‚</h2>

<p>æˆ‘è¿™é‡Œå°±ç›´æ¥ç»™å‡ºéœ€è¦è¡¥çš„ç¯å¢ƒçš„ç»†èŠ‚ï¼Œç›´æ¥æŒ‰ä¸‹é¢çš„å‚æ•°è¡¥å³å¯ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// å®‰è£…ä¾èµ–</span>
<span class="c1">// bun add xhr2</span>

<span class="c1">// åŸºç¡€å…¨å±€å¯¹è±¡è®¾ç½®</span>
<span class="nb">global</span><span class="p">.</span><span class="nx">XMLHttpRequest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">xhr2</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Windowå¯¹è±¡ï¼ˆé¿å…å¾ªç¯å¼•ç”¨ï¼‰</span>
<span class="kd">const</span> <span class="nb">window</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">onwheelx</span><span class="p">:</span> <span class="p">{</span><span class="na">_Ax</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0X21</span><span class="dl">'</span><span class="p">},</span>
  <span class="na">innerHeight</span><span class="p">:</span> <span class="mi">1547</span><span class="p">,</span>
  <span class="na">innerWidth</span><span class="p">:</span> <span class="mi">1917</span><span class="p">,</span>
  <span class="na">outerWidth</span><span class="p">:</span> <span class="mi">3200</span><span class="p">,</span>
  <span class="na">outerHeight</span><span class="p">:</span> <span class="mi">1668</span><span class="p">,</span>
  <span class="na">requestAnimationFrame</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{},</span>
  <span class="na">addEventListener</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{},</span>
  <span class="na">screen</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">availHeight</span><span class="p">:</span> <span class="mi">1668</span><span class="p">,</span>
    <span class="na">availLeft</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">availTop</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="na">availWidth</span><span class="p">:</span> <span class="mi">3200</span><span class="p">,</span>
    <span class="na">colorDepth</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
    <span class="na">height</span><span class="p">:</span> <span class="mi">1800</span><span class="p">,</span>
    <span class="na">isExtended</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">orientation</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">angle</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">onchange</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">landscape-primary</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">pixelDepth</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
    <span class="na">width</span><span class="p">:</span> <span class="mi">3200</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// è®¾ç½®parentå¼•ç”¨</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nb">window</span><span class="p">;</span>

<span class="c1">// Locationå¯¹è±¡</span>
<span class="kd">const</span> <span class="nx">location</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">href</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://www.douyin.com/jingxuan</span><span class="dl">"</span>
<span class="p">};</span>

<span class="c1">// Documentå¯¹è±¡</span>
<span class="kd">const</span> <span class="nb">document</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">all</span><span class="p">:</span> <span class="p">{},</span>
  <span class="na">createElement</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tag_name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">classList</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="na">documentElement</span><span class="p">:</span> <span class="p">{},</span>
  <span class="na">createEvent</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{};</span> <span class="p">},</span>
  <span class="na">addEventListener</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="c1">// Navigatorå¯¹è±¡</span>
<span class="kd">const</span> <span class="nb">navigator</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">userAgent</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><span class="dl">'</span>
<span class="p">};</span>

<span class="c1">// LocalStorageå¯¹è±¡</span>
<span class="kd">const</span> <span class="nx">localStorage</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">getItem</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">xmst</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">æ”¾ç½®ä½ è‡ªå·±çš„xmstå€¼</span><span class="dl">'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Screenå¯¹è±¡</span>
<span class="kd">const</span> <span class="nx">screen</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// å…¨å±€å¼•ç”¨è®¾ç½®</span>
<span class="nx">globalThis</span><span class="p">.</span><span class="nb">window</span> <span class="o">=</span> <span class="nb">window</span><span class="p">;</span>
<span class="nx">globalThis</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">location</span><span class="p">;</span>
<span class="nx">globalThis</span><span class="p">.</span><span class="nb">document</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
<span class="nx">globalThis</span><span class="p">.</span><span class="nb">navigator</span> <span class="o">=</span> <span class="nb">navigator</span><span class="p">;</span>
<span class="nx">globalThis</span><span class="p">.</span><span class="nx">localStorage</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">;</span>
<span class="nx">globalThis</span><span class="p">.</span><span class="nx">screen</span> <span class="o">=</span> <span class="nx">screen</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>

<p>å…ˆæŠŠ <code class="language-plaintext highlighter-rouge">/* V 1.0.1.19-fix.01 */</code> æ•´ä¸ªæºç copyä¸‹æ¥æ”¾åœ¨æœ¬åœ°ï¼Œå°†ä¸Šé¢è¿™æ®µç¯å¢ƒåˆå§‹åŒ–æ”¾åœ¨å¤åˆ¶çš„æºç æœ€å‰é¢ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè¿‡ç›¸å…³çš„ç¯å¢ƒç›‘æµ‹ï¼ˆåç»­æœ‰æœºä¼šå¯ä»¥ä¸“é—¨è®²ä¸‹ç›¸å…³çš„è¡¥ç¯å¢ƒç»†èŠ‚å’Œæµç¨‹ï¼‰ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç°åœ¨æ¥å¥½å¥½è§£é‡Šä¸€ä¸‹å‚æ•°çš„æ„é€ å…¥å£ä»¥åŠéœ€è¦æ³¨æ„çš„ç‚¹ã€‚æœ‰ä¸€ä¸ªæ€è·¯çš„å…³é”®ç‚¹è¿˜æ˜¯åœ¨äº<code class="language-plaintext highlighter-rouge">X(e, this, arguments, r)</code>ï¼ŒåŸç†å°±æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æ–­åœ¨çœŸæ­£å‚æ•°æ„é€ çš„æ—¶å€™ï¼Œæ ¹æ®ç›¸å…³çš„å‡ ä¸ªå‚æ•°<code class="language-plaintext highlighter-rouge">e</code>ã€<code class="language-plaintext highlighter-rouge">argument</code>ã€<code class="language-plaintext highlighter-rouge">this</code>ã€<code class="language-plaintext highlighter-rouge">r</code> è¿™å‡ ä¸ªå‚æ•°çš„ç‰¹å¾ï¼Œç„¶åé€šè¿‡åˆ¤æ–­æ¡ä»¶æ„é€ åŠ å¯†å…¥å£ï¼Œä¾‹å¦‚ï¼Œæˆ‘è¿™é‡Œç›´æ¥ç»™å‡ºå…³é”®æºç ï¼Œå°±èƒ½å¤Ÿæ„é€ å°†åŠ å¯†æ–¹æ³•æš´éœ²åœ¨<code class="language-plaintext highlighter-rouge">window.encrypt</code>ä¸­ï¼Œç›´æ¥è°ƒç”¨ï¼Œä¼ å…¥å¯¹åº”çš„å‚æ•°å³å¯å¾—å‡ºç›®æ ‡å‚æ•°<code class="language-plaintext highlighter-rouge">a_bogus</code> ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// é€šè¿‡ç‰¹å¾å€¼åˆ¤æ–­æ˜¯å¦ä¸ºç›®æ ‡åŠ å¯†å‡½æ•°</span>
  <span class="k">if</span> <span class="p">(</span>
    <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">===</span>
    <span class="dl">"</span><span class="s2">[34,54,0,3,34,30,214,41,212,34,30,214,30,70,54,0,4,74,0,4,30,218,54,0,5,74,0,5,30,72,54,0,6,33,74,2,33,74,0,6,0,1,54,0,7,74,0,7,41,5,74,0,6,53,11,60,161,74,0,6,60,216,30,178,59,2,54,0,8,74,0,8,30,162,18,30,219,73,165,0,1,29,17,5,74,2,3,30,150,41,18,74,0,8,30,162,18,30,163,73,165,74,2,3,30,150,0,2,26,74,0,8,30,162,18,30,219,73,220,0,1,29,41,45,33,74,3,14,0,0,26,33,74,2,37,74,0,8,30,162,18,30,9,0,0,74,0,2,0,2,54,0,9,74,0,8,30,162,18,30,163,73,220,74,0,9,0,2,26,74,0,7,29,41,10,74,0,5,74,0,8,30,178,20,72,34,30,214,18,30,51,63,108,0,1,26,33,74,2,36,74,0,8,30,215,0,1,41,7,33,74,2,5,0,0,26,34,73,214,25,26,74,1,4,18,30,126,34,74,0,2,39,1,0,2,26,33,76]</span><span class="dl">"</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">æ‰¾åˆ°åŠ å¯†å‡½æ•°å…¥å£!</span><span class="dl">"</span><span class="p">);</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">encrypt</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">X</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
<span class="p">};</span>

</code></pre></div></div>

<p>è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨å¦ä¸€ç§æ–¹æ³•ï¼Œç¡®å®æ˜¯åœ¨æŠ–éŸ³é‡Œè¿™æ¯”è¾ƒå–å·§çš„æ–¹å¼ï¼ˆå› åœ°é€‚å®œï¼‰ï¼Œæ„é€ XMLHttpRequestå¯¹è±¡ï¼Œå¹¶ä¸”é€šè¿‡sendå‡½æ•°è§¦å‘ç›¸åº”çš„å‚æ•°æ„é€ ï¼Œç„¶ååœ¨åˆé€‚çš„åœ°æ–¹è¿›è¡Œæˆªå–ï¼Œå°†ç”Ÿæˆçš„åŠ å¯†å‚æ•°ç»™å­˜åœ¨å…¨å±€å˜é‡é‡Œã€‚å…³é”®ä½ç½®åœ¨ä¸‹é¢ï¼Œæˆ‘å°±ç›´æ¥ç»™å‡ºå¯¹åº”çš„å…³é”®ç»“æœäº†ï¼ŒåŸç†è¿˜æ˜¯å’Œä¸Šé¢ä¸€æ ·ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span> <span class="c1">// åŸå§‹ä»£ç </span>
<span class="c1">// ä»¥ä¸‹æ˜¯æˆ‘ä»¬æ·»åŠ çš„æˆªå–ä»£ç </span>
<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">a_bogus</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">got e !!!</span><span class="dl">"</span><span class="p">);</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">a_bogus</span> <span class="o">=</span> <span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">window.a_bogus</span><span class="dl">"</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">a_bogus</span><span class="p">);</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// é€€å‡ºè¿›ç¨‹</span>
<span class="p">}</span>
<span class="nx">v</span><span class="p">[</span><span class="o">++</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m</span><span class="p">;</span> <span class="c1">// åŸå§‹ä»£ç </span>
</code></pre></div></div>

<p>è¿™é‡Œæœ‰ä¸ªç»†èŠ‚ï¼Œåœ¨è·å–åˆ°å‚æ•°åï¼Œæ‰§è¡Œäº†<code class="language-plaintext highlighter-rouge">process.exit(0);</code> ï¼Œä¸ç„¶ç¨‹åºä¼šç»§ç»­æ‰§è¡Œç„¶åæŠ¥é”™ï¼Œæˆ‘åªéœ€è¦å°†æˆªå–åˆ°çš„å‚æ•°æ‹¿å‡ºæ¥å³å¯ï¼Œå½¢å¼ä¸é‡è¦ï¼Œç›®çš„æ‰æ˜¯å…³é”®ï¼</p>

<h2 id="3éªŒè¯å‚æ•°å‚æ•°æœ‰æ•ˆæ€§">3ã€éªŒè¯å‚æ•°å‚æ•°æœ‰æ•ˆæ€§</h2>

<p>æœ‰äº†ä¸Šè¿°å®Œæ•´çš„å‚æ•°ç”Ÿæˆé€»è¾‘ï¼Œå°±èƒ½å¤Ÿé€šè¿‡æ ¹æ®ç›¸å…³çš„è¯·æ±‚ä¿¡æ¯ç”Ÿæˆç›®æ ‡åŠ å¯†å‚æ•°äº†ã€‚æˆ‘è¿™é‡Œæ‹¿çƒ­æœæ¥å£ä½œä¸ºæµ‹è¯•ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ¥å£è¿›è¡Œæµ‹è¯•ã€‚</p>

<p><img src="https://pub-df7ca5ef070b4d47a2a7c8b98941cb71.r2.dev/blog-dy-%20verify.png" alt="éªŒè¯æˆåŠŸç…§ç‰‡" /></p>

<p>å¦‚å›¾æ‰€ç¤ºï¼Œä¸ä»…ç”Ÿæˆå‚æ•°æˆåŠŸï¼Œè¿˜è¿”å›äº†ç›¸å…³çš„æ•°æ®ï¼Œè¯´æ˜æˆ‘ä»¬æ„é€ çš„å‚æ•°æ˜¯åˆç†å¯ç”¨çš„ã€‚æœ‰äº†å‚æ•°åï¼Œå¯èƒ½åç»­éœ€è¦æ³¨æ„çš„å°±æ˜¯ç›¸å…³çš„é£æ§ï¼Œæ¯”å¦‚è®¾å¤‡ã€ç¯å¢ƒä¿¡æ¯ã€è¿˜æœ‰IPã€msTokenç­‰ã€‚ä¸è¿‡åªè¦æœ‰è¶³å¤Ÿè€å¿ƒï¼Œå¹¶ç»†å¿ƒï¼Œæ€»èƒ½åˆæ¢æˆæœï¼Œç¥ä½ é¡ºåˆ©ï¼</p>

<h2 id="-é¢˜å¤–è¯">:) é¢˜å¤–è¯</h2>

<p>ç­‰ä¹‹åæœ‰æ—¶é—´ç²¾åŠ›äº†ï¼Œæˆ‘å†å†™ä¸€ç¯‡è¯¦ç»†è®²è¿°ä¸€ä¸‹æŠ–éŸ³a_bogusç”Ÿæˆä¸­ç”¨åˆ°çš„é­”æ”¹rc4ã€sm3ã€é­”æ”¹base64ç®—æ³•ï¼Œæœ€ä¸»è¦çš„è¿˜æ˜¯ä¸­é—´çš„æ•°ç»„æ ¡éªŒä½ã€‚
å…ˆæŒ–ä¸€ä¸ªå‘ï¼Œç­‰æœ‰ç©ºäº†å†æ›´æ–°å§ï¼Œå¦‚æœä½ é‡åˆ°ç›¸å…³çš„çˆ¬è™«ã€è‡ªåŠ¨åŒ–æˆ–å¼€å‘ç›¸å…³çš„ç–‘éš¾æ‚ç—‡ï¼Œä¹Ÿæ¬¢è¿è”ç³»æˆ‘ã€‚</p>]]></content><author><name>White</name></author><category term="JSVMP" /><category term="é€†å‘" /><category term="æœ‰æ‰‹å°±è¡Œç³»åˆ—ï¼Œé€†å‘" /><category term="JSVMP" /><category term="æŠ–éŸ³" /><summary type="html"><![CDATA[æœ¬æ–‡å°†ç®€å•ç›´æ¥åœ°å¸¦ä½ ä¸€èµ·é€šè¿‡è¡¥ç¯å¢ƒçš„æ–¹å¼ï¼Œå®ç°æŸéŸ³æœ€æ–°çš„a_boguså‚æ•°æ„é€ ï¼Œå¹¶å®ç°éªŒè¯è¯·æ±‚è¿”å›å¯¹åº”æ•°æ®...]]></summary></entry><entry><title type="html">ä¸€ä¸ªç”¨äºè§£å†³JSVMPæµ·é‡æ—¥å¿—å¯¼å‡ºæŠ€å·§</title><link href="https://haloowhite.com/2025/08/05/vmp-log-exporter/" rel="alternate" type="text/html" title="ä¸€ä¸ªç”¨äºè§£å†³JSVMPæµ·é‡æ—¥å¿—å¯¼å‡ºæŠ€å·§" /><published>2025-08-05T00:00:00+08:00</published><updated>2025-08-05T00:00:00+08:00</updated><id>https://haloowhite.com/2025/08/05/vmp-log-exporter</id><content type="html" xml:base="https://haloowhite.com/2025/08/05/vmp-log-exporter/"><![CDATA[<p>åœ¨è¿è¡Œä¹‹å‰å°†ä»¥ä¸‹è¿™æ®µä»£ç è´´è¿›consoleä¸­è¿è¡Œï¼Œç„¶åæ‰§è¡Œéœ€è¦çš„é€»è¾‘ï¼Œå¾…æ—¥å¿—å®Œå…¨æ‰“å°ï¼Œæ‰‹åŠ¨åœ¨consoleæ‰§è¡Œ <code class="language-plaintext highlighter-rouge">console.save()</code>ï¼Œå³å¯ç«‹é©¬å°†æ‰€æœ‰çš„æ—¥å¿—å¯¼å‡ºä¸ºæœ¬åœ°æ–‡ä»¶</p>

<p>æ¥ä¸‹æ¥å°±å¯ä»¥å®‰å®‰å¿ƒå¿ƒåœ¨æœ¬åœ°åˆ†ææ—¥å¿—å†…å®¹äº†</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">VmpLogExporter</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="nx">config</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">maxConsoleLines</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">maxConsoleLines</span> <span class="o">||</span> <span class="mi">800</span><span class="p">,</span>
            <span class="na">exportBatchSize</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">exportBatchSize</span> <span class="o">||</span> <span class="mi">500</span><span class="p">,</span>
            <span class="na">autoExportInterval</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">autoExportInterval</span> <span class="o">||</span> <span class="mi">60000</span><span class="p">,</span> <span class="c1">// 1åˆ†é’Ÿ</span>
            <span class="na">enableAutoExport</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">enableAutoExport</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">logPrefix</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">logPrefix</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">VMP_LOG</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">keepInConsole</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">keepInConsole</span> <span class="o">||</span> <span class="mi">100</span> <span class="c1">// æ§åˆ¶å°ä¿ç•™è¡Œæ•°</span>
        <span class="p">};</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fileCounter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">consoleLineCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">isExporting</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hijackConsole</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">enableAutoExport</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">startAutoExport</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`ğŸš€ VMPæ—¥å¿—å¯¼å‡ºç³»ç»Ÿå·²å¯åŠ¨ - å°†è‡ªåŠ¨ä¿å­˜æ—¥å¿—é¿å…æµè§ˆå™¨å´©æºƒ`</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">hijackConsole</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">originalMethods</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="p">[</span><span class="dl">'</span><span class="s1">log</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">info</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">debug</span><span class="dl">'</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">method</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">originalMethods</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="o">=</span> <span class="nx">console</span><span class="p">[</span><span class="nx">method</span><span class="p">];</span>
            
            <span class="nx">console</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="o">=</span> <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="c1">// è®°å½•åˆ°ç¼“å†²åŒº</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addToBuffer</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
                
                <span class="c1">// æ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…ç†console</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">consoleLineCount</span><span class="o">++</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">consoleLineCount</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">maxConsoleLines</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">manageConsole</span><span class="p">();</span>
                <span class="p">}</span>
                
                <span class="c1">// æ­£å¸¸è¾“å‡ºåˆ°console</span>
                <span class="k">return</span> <span class="nx">originalMethods</span><span class="p">[</span><span class="nx">method</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="p">};</span>
        <span class="p">});</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">originalMethods</span> <span class="o">=</span> <span class="nx">originalMethods</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="nx">addToBuffer</span><span class="p">(</span><span class="nx">level</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">logEntry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">timestamp</span><span class="p">,</span>
            <span class="nx">level</span><span class="p">,</span>
            <span class="na">args</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">serializeArgs</span><span class="p">(</span><span class="nx">args</span><span class="p">),</span>
            <span class="na">raw</span><span class="p">:</span> <span class="nx">args</span>
        <span class="p">};</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">logEntry</span><span class="p">);</span>
        
        <span class="c1">// å¦‚æœç¼“å†²åŒºè¿‡å¤§ï¼Œè‡ªåŠ¨å¯¼å‡º</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">exportBatchSize</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">exportLogs</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nx">serializeArgs</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">args</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">arg</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">arg</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">arg</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">arg</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="dl">'</span><span class="s1">[Circular Reference Object]</span><span class="dl">'</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nb">String</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="nx">manageConsole</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isExporting</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`ğŸ“¤ æ­£åœ¨å¯¼å‡ºæ—¥å¿—é¿å…æµè§ˆå™¨å¡æ­»...`</span><span class="p">);</span>
        
        <span class="c1">// å¯¼å‡ºå½“å‰æ—¥å¿—</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">exportLogs</span><span class="p">();</span>
        
        <span class="c1">// æ¸…ç†consoleä½†ä¿ç•™æœ€æ–°çš„ä¸€äº›æ—¥å¿—</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
        
        <span class="c1">// é‡æ–°æ˜¾ç¤ºæœ€è¿‘çš„é‡è¦æ—¥å¿—</span>
        <span class="kd">const</span> <span class="nx">recentLogs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">keepInConsole</span><span class="p">);</span>
        <span class="nx">recentLogs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">log</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">originalMethods</span><span class="p">[</span><span class="nx">log</span><span class="p">.</span><span class="nx">level</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="p">[</span>
                <span class="s2">`[</span><span class="p">${</span><span class="nx">log</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">}</span><span class="s2">]`</span><span class="p">,</span> 
                <span class="p">...</span><span class="nx">log</span><span class="p">.</span><span class="nx">raw</span>
            <span class="p">]);</span>
        <span class="p">});</span>
        
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`ğŸ”„ Consoleå·²æ¸…ç†ï¼Œä¿ç•™äº†æœ€è¿‘</span><span class="p">${</span><span class="nx">recentLogs</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2">æ¡æ—¥å¿—`</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">consoleLineCount</span> <span class="o">=</span> <span class="nx">recentLogs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">async</span> <span class="nx">exportLogs</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isExporting</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">isExporting</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">[</span><span class="sr">:.</span><span class="se">]</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span><span class="p">);</span>
            <span class="kd">const</span> <span class="nx">filename</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">logPrefix</span><span class="p">}</span><span class="s2">_</span><span class="p">${</span><span class="nx">timestamp</span><span class="p">}</span><span class="s2">_part</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">fileCounter</span><span class="p">}</span><span class="s2">.json`</span><span class="p">;</span>
            
            <span class="kd">const</span> <span class="nx">exportData</span> <span class="o">=</span> <span class="p">{</span>
                <span class="na">exportInfo</span><span class="p">:</span> <span class="p">{</span>
                    <span class="na">timestamp</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
                    <span class="na">partNumber</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">fileCounter</span><span class="p">,</span>
                    <span class="na">totalLogs</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
                    <span class="na">source</span><span class="p">:</span> <span class="dl">'</span><span class="s1">VMP_Logger</span><span class="dl">'</span>
                <span class="p">},</span>
                <span class="na">logs</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span>
            <span class="p">};</span>
            
            <span class="c1">// åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶</span>
            <span class="kd">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">exportData</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span> <span class="p">{</span> 
                <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span> 
            <span class="p">});</span>
            <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
            
            <span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
            <span class="nx">a</span><span class="p">.</span><span class="nx">download</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">;</span>
            <span class="nx">a</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
            <span class="nx">a</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
            <span class="nx">URL</span><span class="p">.</span><span class="nx">revokeObjectURL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
            
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`âœ… å·²å¯¼å‡º </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> æ¡æ—¥å¿—åˆ°æ–‡ä»¶: </span><span class="p">${</span><span class="nx">filename</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
            
            <span class="c1">// æ¸…ç©ºç¼“å†²åŒº</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">fileCounter</span><span class="o">++</span><span class="p">;</span>
            
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">âŒ å¯¼å‡ºæ—¥å¿—å¤±è´¥:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">isExporting</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nx">startAutoExport</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`â° å®šæ—¶å¯¼å‡ºæ—¥å¿—: </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> æ¡`</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">exportLogs</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">autoExportInterval</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// æ‰‹åŠ¨å¯¼å‡ºå½“å‰ç¼“å†²åŒº</span>
    <span class="nx">manualExport</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ğŸ–±ï¸ æ‰‹åŠ¨å¯¼å‡ºæ—¥å¿—...</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">exportLogs</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="c1">// å¯¼å‡ºæ‰€æœ‰æ—¥å¿—çš„åˆå¹¶ç‰ˆæœ¬</span>
    <span class="nx">exportAllLogs</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">[</span><span class="sr">:.</span><span class="se">]</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">filename</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">logPrefix</span><span class="p">}</span><span class="s2">_COMPLETE_</span><span class="p">${</span><span class="nx">timestamp</span><span class="p">}</span><span class="s2">.txt`</span><span class="p">;</span>
        
        <span class="kd">const</span> <span class="nx">allLogs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">log</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">`[</span><span class="p">${</span><span class="nx">log</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">}</span><span class="s2">] </span><span class="p">${</span><span class="nx">log</span><span class="p">.</span><span class="nx">level</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()}</span><span class="s2">: </span><span class="p">${</span><span class="nx">log</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
        <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
        
        <span class="kd">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">allLogs</span><span class="p">],</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span> <span class="p">});</span>
        <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
        
        <span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">download</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">;</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
        <span class="nx">URL</span><span class="p">.</span><span class="nx">revokeObjectURL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
        
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`ğŸ“„ å·²å¯¼å‡ºå®Œæ•´æ–‡æœ¬æ—¥å¿—: </span><span class="p">${</span><span class="nx">filename</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// è·å–çŠ¶æ€ä¿¡æ¯</span>
    <span class="nx">getStatus</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="na">bufferSize</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">logBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="na">consoleLines</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">consoleLineCount</span><span class="p">,</span>
            <span class="na">fileCounter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">fileCounter</span><span class="p">,</span>
            <span class="na">isExporting</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">isExporting</span>
        <span class="p">};</span>
    <span class="p">}</span>
    
    <span class="c1">// æ¢å¤åŸå§‹console</span>
    <span class="nx">restore</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">[</span><span class="dl">'</span><span class="s1">log</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">info</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">debug</span><span class="dl">'</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">method</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">originalMethods</span><span class="p">[</span><span class="nx">method</span><span class="p">];</span>
        <span class="p">});</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ğŸ”„ å·²æ¢å¤åŸå§‹consoleè¡Œä¸º</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ä½¿ç”¨ç¤ºä¾‹å’Œé…ç½®</span>
<span class="kd">const</span> <span class="nx">vmpLogger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VmpLogExporter</span><span class="p">({</span>
    <span class="na">maxConsoleLines</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">,</span>      <span class="c1">// consoleæœ€å¤§è¡Œæ•°</span>
    <span class="na">exportBatchSize</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">,</span>      <span class="c1">// æ‰¹é‡å¯¼å‡ºå¤§å°</span>
    <span class="na">autoExportInterval</span><span class="p">:</span> <span class="mi">60000</span><span class="p">,</span> <span class="c1">// 60ç§’è‡ªåŠ¨å¯¼å‡º</span>
    <span class="na">enableAutoExport</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>    <span class="c1">// å¯ç”¨è‡ªåŠ¨å¯¼å‡º</span>
    <span class="na">logPrefix</span><span class="p">:</span> <span class="dl">'</span><span class="s1">VMP_REVERSE</span><span class="dl">'</span><span class="p">,</span>  <span class="c1">// æ–‡ä»¶å‰ç¼€</span>
    <span class="na">keepInConsole</span><span class="p">:</span> <span class="mi">1000000</span>      <span class="c1">// consoleä¿ç•™è¡Œæ•°</span>
<span class="p">});</span>

<span class="c1">// å…¨å±€è®¿é—®æ¥å£</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">vmpLogger</span> <span class="o">=</span> <span class="nx">vmpLogger</span><span class="p">;</span>

<span class="c1">// æ·»åŠ å¿«æ·å‘½ä»¤</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">save</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">vmpLogger</span><span class="p">.</span><span class="nx">manualExport</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">saveAll</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">vmpLogger</span><span class="p">.</span><span class="nx">exportAllLogs</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">vmpLogger</span><span class="p">.</span><span class="nx">getStatus</span><span class="p">());</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`
ğŸ¯ VMPé€†å‘æ—¥å¿—ç³»ç»Ÿä½¿ç”¨è¯´æ˜:
â€¢ ç³»ç»Ÿä¼šè‡ªåŠ¨ç®¡ç†consoleæ—¥å¿—ï¼Œé¿å…æµè§ˆå™¨å¡æ­»
â€¢ æ‰€æœ‰æ—¥å¿—éƒ½ä¼šä¿å­˜ï¼Œä¸ä¼šä¸¢å¤±ä»»ä½•VMPç®—æ³•ä¿¡æ¯
â€¢ å¿«æ·å‘½ä»¤:
  - console.save() : æ‰‹åŠ¨å¯¼å‡ºå½“å‰æ—¥å¿—
  - console.saveAll() : å¯¼å‡ºå®Œæ•´æ–‡æœ¬æ—¥å¿—
  - console.status() : æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
â€¢ æ—¥å¿—æ–‡ä»¶ä¼šè‡ªåŠ¨ä¸‹è½½åˆ°Downloadsæ–‡ä»¶å¤¹
â€¢ æ¯ä¸ªJSONæ–‡ä»¶åŒ…å«å®Œæ•´çš„æ—¶é—´æˆ³å’Œå…ƒæ•°æ®
`</span><span class="p">);</span>
</code></pre></div></div>]]></content><author><name>White</name></author><category term="JSVMP" /><category term="é€†å‘" /><category term="é€†å‘" /><category term="JSVMP" /><category term="æ—¥å¿—å¯¼å‡º" /><summary type="html"><![CDATA[åœ¨è¿è¡Œä¹‹å‰å°†ä»¥ä¸‹è¿™æ®µä»£ç è´´è¿›consoleä¸­è¿è¡Œï¼Œç„¶åæ‰§è¡Œéœ€è¦çš„é€»è¾‘ï¼Œå¾…æ—¥å¿—å®Œå…¨æ‰“å°ï¼Œæ‰‹åŠ¨åœ¨consoleæ‰§è¡Œ `console.save()`ï¼Œå³å¯ç«‹é©¬å°†æ‰€æœ‰çš„æ—¥å¿—å¯¼å‡ºä¸ºæœ¬åœ°æ–‡ä»¶...]]></summary></entry></feed>